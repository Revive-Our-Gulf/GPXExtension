<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GPX Logger</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/javascript/track.js"></script>
  <script src="/static/javascript/status.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var submitButton = document.getElementById("submit");
      updateButtonColor(submitButton);

      document.getElementById("trackForm").addEventListener("submit", function(event) {
        event.preventDefault();
        var formData = new FormData(this);
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/", true);
        xhr.onload = function() {
          if (xhr.status === 200) {
            // Handle successful response
            console.log("Form submitted successfully");
            // Update button value and color
            submitButton.value = submitButton.value.toLowerCase() === "start" ? "Stop" : "Start";
            updateButtonColor(submitButton);
            location.reload();
          } else {
            // Handle error response
            console.error("Failed to submit form");
          }
        };
        xhr.send(formData);
      });

      function updateButtonColor(button) {
        if (button.value.toLowerCase() === "start") {
          button.classList.remove("btn-danger");
          button.classList.add("btn-success");
        } else if (button.value.toLowerCase() === "stop") {
          button.classList.remove("btn-success");
          button.classList.add("btn-danger");
        }
      }
    });
  </script>
</head>
<body onload="load()">
  {{navbar}}
  <div class="pl-5">
    <div class="pt-4" id="status">
      <form id="trackForm" method="post">
        <div class="form-row align-items-end">
          <div class="form-group col-md-8">
            <label for="track" class="form-label">Track Name:</label>
            <input type="text" class="form-control" name="track" id="track" value="{{trackName}}" />
          </div>
          <div class="form-group col-md-4">
            <input type="hidden" name="submit" value="true">
            <input type="submit" id="submit" name="submitButton" value="{{status}}" class="btn">
          </div>
        </div>
      </form>
      <h2>Latest update</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="col-md-4">Field</th>
            <th class="col-md-8">Value</th>
          </tr>
        </thead>
        <tbody id="statusTable">
          <tr><td class="col-md-4">Created</td><td class="col-md-8" id="created"></td></tr>
          <tr><td class="col-md-4">Latitude</td><td class="col-md-8" id="latitude"></td></tr>
          <tr><td class="col-md-4">Longitude</td><td class="col-md-8" id="longitude"></td></tr>
          <tr><td class="col-md-4">Heading</td><td class="col-md-8" id="heading"></td></tr>
          <tr><td class="col-md-4">Depth</td><td class="col-md-8" id="depth"></td></tr>
          <tr><td class="col-md-4">Altitude</td><td class="col-md-8" id="altitude"></td></tr>
          <tr><td class="col-md-4">Temperature</td><td class="col-md-8" id="temperature"></td></tr>
          <tr><td class="col-md-4">Mode</td><td class="col-md-8" id="mode"></td></tr>
          <tr><td class="col-md-4">Satellite Count</td><td class="col-md-8" id="satelliteCount"></td></tr>
          <tr><td class="col-md-4">Pose Certainty</td><td class="col-md-8" id="poseCertainty"></td></tr>
          <tr><td class="col-md-4">Valid Velocity</td><td class="col-md-8" id="validVelocity"></td></tr>
          <tr><td class="col-md-4">FOM</td><td class="col-md-8" id="fom"></td></tr>
        </tbody>
      </table>
    </div>
    <div class="pt-4">
      <h2>Tracks</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Track Name</th>
            <th>Start Date</th>
            <th>Start Time</th>
            <th>Duration</th>
            <th>Download</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>{{tracks}}</tbody>
      </table>
    </div>
  </div>
</body>
</html>